var q=Object.defineProperty;var L=(e,o,t)=>o in e?q(e,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[o]=t;var d=(e,o,t)=>(L(e,typeof o!="symbol"?o+"":o,t),t);import{r as _,a as G,R as M}from"./react-H14vcryl.js";import{P as m}from"./phaser-pQREW5IE.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();var H={exports:{}},A={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $=_,j=Symbol.for("react.element"),K=Symbol.for("react.fragment"),U=Object.prototype.hasOwnProperty,Y=$.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,X={key:!0,ref:!0,__self:!0,__source:!0};function W(e,o,t){var n,i={},s=null,r=null;t!==void 0&&(s=""+t),o.key!==void 0&&(s=""+o.key),o.ref!==void 0&&(r=o.ref);for(n in o)U.call(o,n)&&!X.hasOwnProperty(n)&&(i[n]=o[n]);if(e&&e.defaultProps)for(n in o=e.defaultProps,o)i[n]===void 0&&(i[n]=o[n]);return{$$typeof:j,type:e,key:s,ref:r,props:i,_owner:Y.current}}A.Fragment=K;A.jsx=W;A.jsxs=W;H.exports=A;var R=H.exports,B={},V=G;B.createRoot=V.createRoot,B.hydrateRoot=V.hydrateRoot;const S={Icons:"Icons",Text:"Courier"},J=async()=>{const e=new FontFace(S.Icons,"url(./fonts/material.woff2)");return document.fonts.add(e),e.load().catch(o=>console.error(o))},T=(e,o=!1)=>m.Display.Color.HexStringToColor(e).darken(o?75:0).color;let P=null;const y=()=>{if(!P){const e=window.AudioContext||window.webkitAudioContext;P=new e}return P},Q=()=>{P=null};function Z(){const e=y(),o=e.sampleRate*.05,t=e.createBuffer(1,o,e.sampleRate),n=t.getChannelData(0);for(let l=0;l<o;l++)n[l]=Math.random()*2-1;const i=e.createBufferSource();i.buffer=t;const s=e.createBiquadFilter();s.type="highpass",s.frequency.setValueAtTime(8e3,e.currentTime),s.Q.setValueAtTime(1,e.currentTime);const r=e.createGain();r.gain.setValueAtTime(1,e.currentTime),r.gain.exponentialRampToValueAtTime(.001,e.currentTime+.05),i.connect(s),s.connect(r),r.connect(e.destination),i.start(),i.stop(e.currentTime+.05);const a=e.createOscillator();a.type="square",a.frequency.setValueAtTime(1e4,e.currentTime);const c=e.createGain();c.gain.setValueAtTime(.1,e.currentTime),c.gain.exponentialRampToValueAtTime(.001,e.currentTime+.03),a.connect(c),c.connect(e.destination),a.start(),a.stop(e.currentTime+.03)}function ee(){const e=y(),o=e.createOscillator();o.type="sine";const t=e.createGain();o.frequency.setValueAtTime(200,e.currentTime),o.frequency.exponentialRampToValueAtTime(70,e.currentTime+.05),t.gain.setValueAtTime(1,e.currentTime),t.gain.exponentialRampToValueAtTime(.001,e.currentTime+1),o.connect(t),t.connect(e.destination),o.start(),o.stop(e.currentTime+1.5)}function te(){const e=y(),o=e.sampleRate*.2,t=e.createBuffer(1,o,e.sampleRate),n=t.getChannelData(0);for(let l=0;l<o;l++)n[l]=Math.random()*2-1;const i=e.createBufferSource();i.buffer=t;const s=e.createBiquadFilter();s.type="highpass",s.frequency.setValueAtTime(1e3,e.currentTime);const r=e.createGain();r.gain.setValueAtTime(1,e.currentTime),r.gain.exponentialRampToValueAtTime(.01,e.currentTime+.2),i.connect(s),s.connect(r),r.connect(e.destination),i.start(),i.stop(e.currentTime+.2);const a=e.createOscillator();a.type="sine",a.frequency.setValueAtTime(150,e.currentTime);const c=e.createGain();c.gain.setValueAtTime(.7,e.currentTime),c.gain.exponentialRampToValueAtTime(.01,e.currentTime+.1),a.connect(c),c.connect(e.destination),a.start(),a.stop(e.currentTime+.1)}function ne(){const e=y(),o=e.sampleRate*1.5,t=e.createBuffer(1,o,e.sampleRate),n=t.getChannelData(0);for(let g=0;g<o;g++)n[g]=Math.random()*2-1;const i=e.createBufferSource();i.buffer=t;const s=e.createBiquadFilter();s.type="highpass",s.frequency.setValueAtTime(4e3,e.currentTime);const r=e.createBiquadFilter();r.type="lowpass",r.frequency.setValueAtTime(12e3,e.currentTime);const a=e.createGain();a.gain.setValueAtTime(1,e.currentTime),a.gain.exponentialRampToValueAtTime(.001,e.currentTime+1.5),i.connect(s),s.connect(r),r.connect(a),a.connect(e.destination),i.start(),i.stop(e.currentTime+1.5);const c=e.createOscillator();c.type="triangle",c.frequency.setValueAtTime(1e4,e.currentTime);const l=e.createGain();l.gain.setValueAtTime(.05,e.currentTime),l.gain.exponentialRampToValueAtTime(.001,e.currentTime+1.5),c.connect(l),l.connect(e.destination),c.start(),c.stop(e.currentTime+1.5)}function ie(){const e=y(),o=e.sampleRate*.5,t=e.createBuffer(1,o,e.sampleRate),n=t.getChannelData(0);for(let c=0;c<o;c++)n[c]=Math.random()*2-1;const i=e.createBufferSource();i.buffer=t;const s=e.createBiquadFilter();s.type="highpass",s.frequency.setValueAtTime(5e3,e.currentTime);const r=e.createBiquadFilter();r.type="lowpass",r.frequency.setValueAtTime(1e4,e.currentTime);const a=e.createGain();a.gain.setValueAtTime(.6,e.currentTime),a.gain.exponentialRampToValueAtTime(.001,e.currentTime+.5),i.connect(s),s.connect(r),r.connect(a),a.connect(e.destination),i.start(),i.stop(e.currentTime+.5)}function oe(){const e=y(),o=e.sampleRate*1.2,t=e.createBuffer(1,o,e.sampleRate),n=t.getChannelData(0);for(let c=0;c<o;c++)n[c]=Math.random()*2-1;const i=e.createBufferSource();i.buffer=t;const s=e.createBiquadFilter();s.type="highpass",s.frequency.setValueAtTime(3e3,e.currentTime);const r=e.createBiquadFilter();r.type="lowpass",r.frequency.setValueAtTime(9e3,e.currentTime);const a=e.createGain();a.gain.setValueAtTime(.8,e.currentTime),a.gain.exponentialRampToValueAtTime(.001,e.currentTime+1.2),i.connect(s),s.connect(r),r.connect(a),a.connect(e.destination),i.start(),i.stop(e.currentTime+1.2)}function z(e=99,o=500){const t=y(),n=t.createOscillator();n.type="sine",n.frequency.setValueAtTime(e,t.currentTime);const i=t.createGain();i.gain.setValueAtTime(1,t.currentTime),i.gain.exponentialRampToValueAtTime(.001,t.currentTime+.5),n.detune.setValueAtTime(-5,t.currentTime),n.connect(i),i.connect(t.destination),n.start(),n.stop(t.currentTime+o/1e3)}function se(){z(120,400)}const v={hihat:Z,kick:ee,snare:te,crash:ne,"hihat-open":ie,ride:oe,"tom-low":z,"tom-high":se},b=e=>{try{v[e]()}catch(o){console.error(`Error playing ${e}`,o),Q(),v[e]()}},re=(e,o,t)=>{const n=[];for(let s=0;s<t;s++)n.push(e.slice(s*o,s*o+o));return n[0].map((s,r)=>n.map(a=>a[r]).reverse()).flat()},ae={hihat:"#FDA341",kick:"#F24E1E",snare:"#4A90E2",crash:"#A0D8C5","hihat-open":"#F9F871",ride:"#F5C542","tom-low":"#FF7F50","tom-high":"#9B59B6"};class O extends m.Scene{constructor(o="drums"){super(),this.type=o}create({type:o}){o&&(this.type=o),this.createPads(),this.scene.get(p.key).events.emit("track-selected")}createPads(){const o=[this.createPad("crash"),this.createPad("ride"),this.createPad("hihat-open"),this.createPad("hihat"),this.createPad("snare"),this.createPad("tom-low"),this.createPad("tom-high"),this.createPad("kick")],t=()=>{const n=window.innerWidth<window.innerHeight,i=n?2:4,s=n?4:2,r=n?window.innerWidth/i:(window.innerWidth-p.sceneWidthHeight)/i,a=n?(window.innerHeight-p.sceneWidthHeight)/s:window.innerHeight/s;(n?re(o,s,i):o).forEach(({button:l},g)=>{const x=g%i*r,u=Math.floor(g/i)*a,w=n?0:p.sceneWidthHeight,f=n?p.sceneWidthHeight:0;l.setSize(r,a).setPosition(w+x,f+u)})};window.addEventListener("resize",t),t()}createPad(o){const t=this.add.rectangle().setFillStyle(T(ae[o],this.type==="drums")).setStrokeStyle(2,T("#FFF"),.8).setInteractive().setOrigin(0,0);return t.on("pointerdown",()=>{t.setAlpha(.7),b(o),this.scene.get(p.key).events.emit("instrument-played",{instrument:o,scene:this})}).on("pointerup",()=>t.setAlpha(1)).on("pointerout",()=>t.setAlpha(1)),{instrument:o,button:t}}}const k=class k extends m.Scene{constructor(){super(k.key);d(this,"rowNumber",5);d(this,"colNumber",5);d(this,"instrumentButtons")}create({index:t}){this.scene.bringToTop(),this.cameras.main.setOrigin(0,0).setBackgroundColor("#147"),this.createMatrix();const n=this.instrumentButtons[1][2];n.setData("text",this.addText(n,"Drums"));const i=this.instrumentButtons[3][2];i.setData("text",this.addText(i,"Other Drums")),[n,i].forEach(a=>a.setFillStyle(T("#FFF"),.5).setInteractive().on(m.Input.Events.POINTER_DOWN,()=>{this.scene.setVisible(!1)}));const r=`track_scene_${t}`;n.on(m.Input.Events.POINTER_UP,()=>{this.scene.add(r,O,!0,{type:"drums"})}),i.on(m.Input.Events.POINTER_UP,()=>{this.scene.add(r,O,!0,{type:"other"})}),window.addEventListener("resize",()=>this.resizeScene()),this.resizeScene()}createMatrix(){this.instrumentButtons=[];for(let t=0;t<this.colNumber;t++){this.instrumentButtons.push([]);for(let n=0;n<this.rowNumber;n++)this.instrumentButtons[t].push(this.add.rectangle().setOrigin(0,0).setStrokeStyle(2,T("#FFF"),.1))}}addText(t,n){return this.add.text(t.x+t.width/2,t.y+t.height/2,n,{fontSize:"24px",color:"#FFF",fontFamily:S.Text}).setOrigin(.5)}resizeScene(){const t=window.innerWidth<window.innerHeight,n=p.sceneWidthHeight,i=t?window.innerWidth/this.colNumber:(window.innerWidth-n)/this.colNumber,s=t?(window.innerHeight-n)/this.rowNumber:window.innerHeight/this.rowNumber;this.instrumentButtons.forEach((g,x)=>{g.forEach((u,w)=>{u.setSize(i,s).setPosition(i*x,s*w);const f=u.getData("text");if(f){const I=Math.min(u.height,u.width)/5;f.setFontSize(I).setResolution(2).setWordWrapWidth(u.width,!0).setSize(u.width,u.height).setPosition(u.getCenter().x,u.getCenter().y)}})});const r=t?window.innerWidth:window.innerWidth-n,a=t?window.innerHeight-n:window.innerHeight,c=t?0:n,l=t?n:0;this.cameras.main.setPosition(c,l).setViewport(c,l,r,a)}};d(k,"key","EmptyScene");let C=k;class ce{constructor(o){d(this,"state","readyToRecord");d(this,"loop",[]);d(this,"startRecordingTime",0);d(this,"currentLoopIndex",0);d(this,"loopTimeout",null);this.trackIndex=o}handleClick(){switch(this.nextState(),this.state){case"recording":this.startRecording();break;case"playing":this.startPlaying();break;case"readyToPlay":this.stopPlaying();break}}addInstrument(o){this.isRecording()&&(this.loop.push({instrument:o,time:Date.now()-this.startRecordingTime}),this.log(`Recording ${o} at time ${Date.now()-this.startRecordingTime}ms`))}isPlaying(){return this.state==="playing"}isReadyToPlay(){return this.state==="readyToPlay"}isRecording(){return this.state==="recording"}isReadyToRecord(){return this.state==="readyToRecord"}nextState(){switch(this.state){case"readyToRecord":this.state="recording";break;case"recording":this.stopRecording(),this.state="playing";break;case"readyToPlay":this.state="playing";break;case"playing":this.state="readyToPlay";break}}startRecording(){this.startRecordingTime=Date.now(),this.loop=[],this.log("Recording started")}stopRecording(){this.loop.push({instrument:null,time:Date.now()-this.startRecordingTime}),this.log("Recording stopped")}startPlaying(){const o=()=>{this.currentLoopIndex>=this.loop.length&&(this.currentLoopIndex=0);const{instrument:t,time:n}=this.loop[this.currentLoopIndex],i=this.currentLoopIndex===0?0:this.loop[this.currentLoopIndex-1].time;this.loopTimeout=setTimeout(()=>{this.log(`Playing ${t} after ${n}ms`),t&&b(t),this.currentLoopIndex++,o()},n-i)};this.log("Loop play starting"),o()}stopPlaying(){this.loopTimeout&&clearTimeout(this.loopTimeout),this.currentLoopIndex=0,this.log("Loop stopped")}log(o,t){console.log(`Loop ${this.trackIndex+1}: ${o}`,t)}}const le={selected:"#DDD",unselected:"#000"},E={play:"play_arrow",record:"fiber_manual_record",stop:"stop"},F={idle:"#FFF",readyToRecord:"#0FF",recording:"#FD0041",playing:"#0F0"},h=class h extends m.Scene{constructor(){super(h.key);d(this,"tracks");d(this,"resizeTracks",()=>{const t=window.innerWidth<window.innerHeight,n=t?window.innerWidth/h.numTracks:h.sceneWidthHeight,i=t?h.sceneWidthHeight:window.innerHeight/h.numTracks;this.tracks.forEach(({button:s,buttonText:r,buttonSelectedCircle:a,controlIcon:c},l)=>{const g=t?n*l:0,x=t?-1:i*l;s.setSize(n,i).setPosition(g,x);const u=t?s.getCenter().x:s.getCenter().x-n/4,w=t?s.getCenter().y-i/4:s.getCenter().y,f=Math.min(i,n);r.setResolution(3).setSize(n,i).setFontSize(f/4).setPosition(u,w),a.setSize(f/3,f/3).setPosition(u,w);const I=t?s.getCenter().x:s.getCenter().x+n/4,N=t?s.getCenter().y+i/4:s.getCenter().y;c.setFontSize(f/1.7).setPosition(I,N)}),this.cameras.main.setViewport(0,0,t?window.innerWidth:n,t?i:window.innerHeight)})}static get sceneWidthHeight(){const t=window.innerWidth,n=window.innerHeight;return Math.max(n,t)/10}create(){this.cameras.main.setOrigin(0,0).setPosition(0,0).setViewport(0,0,h.sceneWidthHeight,window.innerHeight).setBackgroundColor("#963"),this.createTracks(),this.events.on("track-selected",()=>{this.updateControlsState()}),this.events.on("instrument-played",({instrument:t})=>{var n,i;(i=(n=this.tracks.find(s=>s.selected))==null?void 0:n.loop)==null||i.addInstrument(t)})}createTracks(){this.tracks=new Array(h.numTracks).fill(null).map((t,n)=>({loop:new ce(n),button:this.add.rectangle().setOrigin(0,0).setStrokeStyle(2,T("#FFF"),.8).setInteractive().on(m.Input.Events.POINTER_DOWN,()=>this.selectTrack(n)),selected:!1,buttonSelectedCircle:this.add.ellipse(0,0,0,0,T("#FFF")),buttonText:this.add.text(0,0,`${n+1}`,{fontFamily:S.Text,fontSize:"24px",color:"#FFF"}).setOrigin(.5,.5).setResolution(2),controlIcon:this.add.text(0,0,"",{fontFamily:S.Icons,fontSize:"24px",color:"#FFF"}).setOrigin(.5,.5).setResolution(2).setInteractive().on(m.Input.Events.POINTER_DOWN,()=>{this.handleControlClicked(n)})})),window.addEventListener("resize",()=>this.resizeTracks()),this.resizeTracks(),this.selectTrack(0)}handleControlClicked(t){this.tracks[t].loop.handleClick(),this.updateControlsState()}selectTrack(t){const n=this.tracks[t];if(!n.selected){const i=this.tracks.find(r=>r.selected);i&&(i.selected=!1,i.loop.isRecording()&&i.loop.handleClick()),n.selected=!0,this.updateControlsState();const s=this.getTrackScene(t);s?s.scene.bringToTop():this.game.scene.start(C.key,{index:t})}}static getTrackSceneKey(t){return`track_scene_${t}`}getTrackScene(t){return this.scene.get(h.getTrackSceneKey(t))}updateControlsState(){this.tracks.forEach((t,n)=>{t.button.setFillStyle(T(le.unselected)),t.buttonText.setColor(t.selected?"#000":"#FFF"),t.buttonSelectedCircle.setFillStyle(T(t.selected?"#FFF":"#000")),this.getTrackScene(n)&&(t.selected&&(t.loop.isRecording()||t.loop.isReadyToRecord())?t.controlIcon.setText(E.record).setColor(t.loop.isRecording()?F.recording:F.idle):t.loop.isPlaying()||t.loop.isReadyToPlay()?t.controlIcon.setText(E.play).setColor(t.loop.isPlaying()?F.playing:F.idle):t.controlIcon.setText("").setColor(F.idle))})}};d(h,"key","LoopTracksScene"),d(h,"numTracks",5);let p=h;const ue=()=>window.matchMedia("(prefers-color-scheme: dark)").matches;function de(e){const o=window.innerWidth,t=window.innerHeight;e.scale.resize(o,t),e.scene.scenes.forEach(n=>{var i,s;return(s=(i=n.sys)==null?void 0:i.scale)==null?void 0:s.refresh()})}let D=!1;const he=()=>(D||(D=!0,J().then(()=>{const e=new m.Game({type:m.AUTO,mode:m.Scale.RESIZE,parent:"phaser-container",width:window.innerWidth,height:window.innerHeight,backgroundColor:ue()?"#333":"#DDD",scene:[p,C],input:{activePointers:4}});window.addEventListener("resize",()=>{de(e)}),e.scene.start(p.key)})),R.jsx(R.Fragment,{}));function me(){return R.jsx(he,{})}B.createRoot(document.getElementById("root")).render(R.jsx(M.StrictMode,{children:R.jsx(me,{})}));
