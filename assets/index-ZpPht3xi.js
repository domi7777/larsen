var G=Object.defineProperty;var N=(e,o,t)=>o in e?G(e,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[o]=t;var P=(e,o,t)=>(N(e,typeof o!="symbol"?o+"":o,t),t);import{r as z,a as H,R as L}from"./react-H14vcryl.js";import{P as T}from"./phaser-pQREW5IE.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function t(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(n){if(n.ep)return;n.ep=!0;const r=t(n);fetch(n.href,r)}})();var O={exports:{}},x={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var M=z,k=Symbol.for("react.element"),I=Symbol.for("react.fragment"),W=Object.prototype.hasOwnProperty,j=M.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,$={key:!0,ref:!0,__self:!0,__source:!0};function v(e,o,t){var i,n={},r=null,s=null;t!==void 0&&(r=""+t),o.key!==void 0&&(r=""+o.key),o.ref!==void 0&&(s=o.ref);for(i in o)W.call(o,i)&&!$.hasOwnProperty(i)&&(n[i]=o[i]);if(e&&e.defaultProps)for(i in o=e.defaultProps,o)n[i]===void 0&&(n[i]=o[i]);return{$$typeof:k,type:e,key:r,ref:s,props:n,_owner:j.current}}x.Fragment=I;x.jsx=v;x.jsxs=v;O.exports=x;var g=O.exports,C={},b=H;C.createRoot=b.createRoot,C.hydrateRoot=b.hydrateRoot;const p=e=>T.Display.Color.HexStringToColor(e).color;let F=null;const h=()=>{if(!F){const e=window.AudioContext||window.webkitAudioContext;F=new e}return F},U=()=>{F=null};function K(){const e=h(),o=e.sampleRate*.05,t=e.createBuffer(1,o,e.sampleRate),i=t.getChannelData(0);for(let l=0;l<o;l++)i[l]=Math.random()*2-1;const n=e.createBufferSource();n.buffer=t;const r=e.createBiquadFilter();r.type="highpass",r.frequency.setValueAtTime(8e3,e.currentTime),r.Q.setValueAtTime(1,e.currentTime);const s=e.createGain();s.gain.setValueAtTime(1,e.currentTime),s.gain.exponentialRampToValueAtTime(.001,e.currentTime+.05),n.connect(r),r.connect(s),s.connect(e.destination),n.start(),n.stop(e.currentTime+.05);const c=e.createOscillator();c.type="square",c.frequency.setValueAtTime(1e4,e.currentTime);const a=e.createGain();a.gain.setValueAtTime(.1,e.currentTime),a.gain.exponentialRampToValueAtTime(.001,e.currentTime+.03),c.connect(a),a.connect(e.destination),c.start(),c.stop(e.currentTime+.03)}function J(){const e=h(),o=e.createOscillator();o.type="sine";const t=e.createGain();o.frequency.setValueAtTime(200,e.currentTime),o.frequency.exponentialRampToValueAtTime(70,e.currentTime+.05),t.gain.setValueAtTime(1,e.currentTime),t.gain.exponentialRampToValueAtTime(.001,e.currentTime+1),o.connect(t),t.connect(e.destination),o.start(),o.stop(e.currentTime+1.5)}function Q(){const e=h(),o=e.sampleRate*.2,t=e.createBuffer(1,o,e.sampleRate),i=t.getChannelData(0);for(let l=0;l<o;l++)i[l]=Math.random()*2-1;const n=e.createBufferSource();n.buffer=t;const r=e.createBiquadFilter();r.type="highpass",r.frequency.setValueAtTime(1e3,e.currentTime);const s=e.createGain();s.gain.setValueAtTime(1,e.currentTime),s.gain.exponentialRampToValueAtTime(.01,e.currentTime+.2),n.connect(r),r.connect(s),s.connect(e.destination),n.start(),n.stop(e.currentTime+.2);const c=e.createOscillator();c.type="sine",c.frequency.setValueAtTime(150,e.currentTime);const a=e.createGain();a.gain.setValueAtTime(.7,e.currentTime),a.gain.exponentialRampToValueAtTime(.01,e.currentTime+.1),c.connect(a),a.connect(e.destination),c.start(),c.stop(e.currentTime+.1)}function Y(){const e=h(),o=e.sampleRate*1.5,t=e.createBuffer(1,o,e.sampleRate),i=t.getChannelData(0);for(let u=0;u<o;u++)i[u]=Math.random()*2-1;const n=e.createBufferSource();n.buffer=t;const r=e.createBiquadFilter();r.type="highpass",r.frequency.setValueAtTime(4e3,e.currentTime);const s=e.createBiquadFilter();s.type="lowpass",s.frequency.setValueAtTime(12e3,e.currentTime);const c=e.createGain();c.gain.setValueAtTime(1,e.currentTime),c.gain.exponentialRampToValueAtTime(.001,e.currentTime+1.5),n.connect(r),r.connect(s),s.connect(c),c.connect(e.destination),n.start(),n.stop(e.currentTime+1.5);const a=e.createOscillator();a.type="triangle",a.frequency.setValueAtTime(1e4,e.currentTime);const l=e.createGain();l.gain.setValueAtTime(.05,e.currentTime),l.gain.exponentialRampToValueAtTime(.001,e.currentTime+1.5),a.connect(l),l.connect(e.destination),a.start(),a.stop(e.currentTime+1.5)}function Z(){const e=h(),o=e.sampleRate*.5,t=e.createBuffer(1,o,e.sampleRate),i=t.getChannelData(0);for(let a=0;a<o;a++)i[a]=Math.random()*2-1;const n=e.createBufferSource();n.buffer=t;const r=e.createBiquadFilter();r.type="highpass",r.frequency.setValueAtTime(5e3,e.currentTime);const s=e.createBiquadFilter();s.type="lowpass",s.frequency.setValueAtTime(1e4,e.currentTime);const c=e.createGain();c.gain.setValueAtTime(.6,e.currentTime),c.gain.exponentialRampToValueAtTime(.001,e.currentTime+.5),n.connect(r),r.connect(s),s.connect(c),c.connect(e.destination),n.start(),n.stop(e.currentTime+.5)}function X(){const e=h(),o=e.sampleRate*1.2,t=e.createBuffer(1,o,e.sampleRate),i=t.getChannelData(0);for(let a=0;a<o;a++)i[a]=Math.random()*2-1;const n=e.createBufferSource();n.buffer=t;const r=e.createBiquadFilter();r.type="highpass",r.frequency.setValueAtTime(3e3,e.currentTime);const s=e.createBiquadFilter();s.type="lowpass",s.frequency.setValueAtTime(9e3,e.currentTime);const c=e.createGain();c.gain.setValueAtTime(.8,e.currentTime),c.gain.exponentialRampToValueAtTime(.001,e.currentTime+1.2),n.connect(r),r.connect(s),s.connect(c),c.connect(e.destination),n.start(),n.stop(e.currentTime+1.2)}function D(e=99,o=500){const t=h(),i=t.createOscillator();i.type="sine",i.frequency.setValueAtTime(e,t.currentTime);const n=t.createGain();n.gain.setValueAtTime(1,t.currentTime),n.gain.exponentialRampToValueAtTime(.001,t.currentTime+.5),i.detune.setValueAtTime(-5,t.currentTime),i.connect(n),n.connect(t.destination),i.start(),i.stop(t.currentTime+o/1e3)}function ee(){D(120,400)}const V={hihat:K,kick:J,snare:Q,crash:Y,"hihat-open":Z,ride:X,"tom-low":D,"tom-high":ee},_=e=>{console.log(`Playing ${e}`);try{V[e]()}catch(o){console.error(`Error playing ${e}`,o),U(),V[e]()}if(R){const o=Date.now()-S;m.push({instrument:e,time:o}),console.log(`Recording ${e} at time ${o}ms`)}};let R=!1,S=0,m=[],f=0,A=null;function te(){R=!0,S=Date.now(),m=[],console.log("Recording started")}function w(){R=!1,m.push({instrument:null,time:Date.now()-S}),console.log("Recording stopped")}function oe(){const e=()=>{f>=m.length&&(f=0);const{instrument:o,time:t}=m[f],i=f===0?0:m[f-1].time;A=setTimeout(()=>{console.log(`Playing ${o} after ${t}ms`),o&&_(o),f++,e()},t-i)};console.log("Loop play starting"),e()}function B(){A&&clearTimeout(A),console.log("Loop stopped")}const d={Material:"Material",Arial:"Arial"},ne=async()=>{const e=new FontFace(d.Material,"url(./fonts/material.woff2)");return document.fonts.add(e),e.load().catch(o=>console.error(o))},q={idle:"#FFF",readyToRecord:"#0FF",recording:"#FD0041",playing:"#0F0"};class y extends T.Scene{constructor(){super("ControlsScene");P(this,"controls")}static get controlsSceneHeight(){const t=window.innerWidth,i=window.innerHeight;return Math.max(i,t)/10}create(){this.createControlButtons()}updateControlsText(){const{record:{text:t},stop:{text:i},play:{text:n}}=this.controls;[t,i,n].forEach(s=>s.setFontFamily(d.Material).setText(s.getData("initial")).setColor(q.idle));const r=q[this.controls.state];switch(this.controls.state){case"idle":break;case"readyToRecord":t.setFontFamily(d.Arial).setText("Hit a pad to start").setColor(r);break;case"recording":t.setFontFamily(d.Material).setColor(r);break;case"playing":n.setFontFamily(d.Material).setColor(r);break}}addControlButton(){const t=this.add.rectangle().setFillStyle(p("#000")).setStrokeStyle(2,p("#FFF"),.8).setOrigin(0,0);return t.setInteractive().on("pointerdown",()=>t.setFillStyle(p("#666"))).on("pointerup",()=>t.setFillStyle(p("#000"))).on("pointerout",()=>t.setFillStyle(p("#000"))),t}addControlText(t){return this.add.text(0,0,t,{fontFamily:d.Material,fontSize:20,color:"#FFF",align:"center",resolution:2}).setOrigin(.5,.5).setData("initial",t)}createControlButtons(){this.controls={state:"idle",stop:{button:this.addControlButton(),text:this.addControlText("stop")},record:{button:this.addControlButton(),text:this.addControlText("fiber_manual_record")},play:{button:this.addControlButton(),text:this.addControlText("play_arrow")}};const{record:t,stop:i,play:n}=this.controls;t.button.setInteractive().on("pointerdown",()=>{this.controls.state==="idle"||this.controls.state==="playing"?(B(),this.controls.state="readyToRecord"):this.controls.state==="readyToRecord"?this.controls.state="idle":this.controls.state==="recording"&&(this.controls.state="idle",w()),this.updateControlsText()}),i.button.setInteractive().on("pointerdown",()=>{this.controls.state==="recording"&&w(),this.controls.state==="playing"&&B(),this.controls.state="idle",this.updateControlsText()}),n.button.setInteractive().on("pointerdown",()=>{this.controls.state==="recording"&&w(),m.length>0?(this.controls.state="playing",oe(),this.updateControlsText()):(this.controls.state="idle",this.updateControlsText(),console.log("No loop to play"),this.controls.play.text.setFontFamily(d.Arial).setText("No loop to play, record first"),this.time.delayedCall(2e3,()=>{this.updateControlsText()}))});const r=()=>{const s=y.controlsSceneHeight,c=window.innerWidth/3;[i,t,n].forEach(({button:a,text:l},u)=>{a.setSize(c,s).setPosition(c*u,-1),l.setFontSize(s/2).setWordWrapWidth(a.width,!0).setSize(a.width,a.height).setPosition(a.getCenter().x,a.getCenter().y)})};window.addEventListener("resize",r),r()}}const re={hihat:"#FDA341",kick:"#F24E1E",snare:"#4A90E2",crash:"#A0D8C5","hihat-open":"#F9F871",ride:"#F5C542","tom-low":"#FF7F50","tom-high":"#9B59B6"};class ie extends T.Scene{constructor(){super("DrumsScene")}create(){this.createPads()}createPads(){const o=[this.createPad("crash"),this.createPad("ride"),this.createPad("hihat-open"),this.createPad("hihat"),this.createPad("snare"),this.createPad("tom-low"),this.createPad("tom-high"),this.createPad("kick")],t=()=>{const r=window.innerWidth/4,s=(window.innerHeight-y.controlsSceneHeight)/2;o.forEach(({button:c},a)=>{const l=a%4*r,u=Math.floor(a/4)*s;c.setSize(r,s).setPosition(l,y.controlsSceneHeight+u)})};window.addEventListener("resize",t),t()}createPad(o){const t=this.add.rectangle().setFillStyle(p(re[o])).setStrokeStyle(2,p("#FFF"),.8).setInteractive().setOrigin(0,0);return t.on("pointerdown",()=>{t.setAlpha(.7);const i=this.scene.get("ControlsScene");i.controls.state==="readyToRecord"&&(i.controls.state="recording",i.updateControlsText(),te()),_(o)}).on("pointerup",()=>t.setAlpha(1)).on("pointerout",()=>t.setAlpha(1)),{instrument:o,button:t}}}function se(e){const o=window.innerWidth,t=window.innerHeight;e.scale.resize(o,t),e.scene.scenes.forEach(i=>{var n,r;return(r=(n=i.sys)==null?void 0:n.scale)==null?void 0:r.refresh()})}let E=!1;const ae=()=>(E||(E=!0,ne().then(()=>{const e=new T.Game({type:T.AUTO,mode:T.Scale.RESIZE,parent:"phaser-container",width:window.innerWidth,height:window.innerHeight,backgroundColor:"#FFF",scene:[y,ie],input:{activePointers:4}});window.addEventListener("resize",()=>{se(e)}),e.scene.start("ControlsScene"),e.scene.start("DrumsScene")})),g.jsx(g.Fragment,{}));function ce(){return g.jsx(ae,{})}C.createRoot(document.getElementById("root")).render(g.jsx(L.StrictMode,{children:g.jsx(ce,{})}));
