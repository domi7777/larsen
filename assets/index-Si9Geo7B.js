var z=Object.defineProperty;var G=(e,n,t)=>n in e?z(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t;var x=(e,n,t)=>(G(e,typeof n!="symbol"?n+"":n,t),t);import{r as _,a as L,R as M}from"./react-H14vcryl.js";import{P as h}from"./phaser-pQREW5IE.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function t(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(o){if(o.ep)return;o.ep=!0;const r=t(o);fetch(o.href,r)}})();var I={exports:{}},C={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var j=_,$=Symbol.for("react.element"),U=Symbol.for("react.fragment"),K=Object.prototype.hasOwnProperty,J=j.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Q={key:!0,ref:!0,__self:!0,__source:!0};function q(e,n,t){var s,o={},r=null,i=null;t!==void 0&&(r=""+t),n.key!==void 0&&(r=""+n.key),n.ref!==void 0&&(i=n.ref);for(s in n)K.call(n,s)&&!Q.hasOwnProperty(s)&&(o[s]=n[s]);if(e&&e.defaultProps)for(s in n=e.defaultProps,n)o[s]===void 0&&(o[s]=n[s]);return{$$typeof:$,type:e,key:r,ref:i,props:o,_owner:J.current}}C.Fragment=U;C.jsx=q;C.jsxs=q;I.exports=C;var F=I.exports,A={},b=L;A.createRoot=b.createRoot,A.hydrateRoot=b.hydrateRoot;const u=(e,n=!1)=>h.Display.Color.HexStringToColor(e).darken(n?75:0).color;let S=null;const g=()=>{if(!S){const e=window.AudioContext||window.webkitAudioContext;S=new e}return S},Y=()=>{S=null};function Z(){const e=g(),n=e.sampleRate*.05,t=e.createBuffer(1,n,e.sampleRate),s=t.getChannelData(0);for(let l=0;l<n;l++)s[l]=Math.random()*2-1;const o=e.createBufferSource();o.buffer=t;const r=e.createBiquadFilter();r.type="highpass",r.frequency.setValueAtTime(8e3,e.currentTime),r.Q.setValueAtTime(1,e.currentTime);const i=e.createGain();i.gain.setValueAtTime(1,e.currentTime),i.gain.exponentialRampToValueAtTime(.001,e.currentTime+.05),o.connect(r),r.connect(i),i.connect(e.destination),o.start(),o.stop(e.currentTime+.05);const c=e.createOscillator();c.type="square",c.frequency.setValueAtTime(1e4,e.currentTime);const a=e.createGain();a.gain.setValueAtTime(.1,e.currentTime),a.gain.exponentialRampToValueAtTime(.001,e.currentTime+.03),c.connect(a),a.connect(e.destination),c.start(),c.stop(e.currentTime+.03)}function X(){const e=g(),n=e.createOscillator();n.type="sine";const t=e.createGain();n.frequency.setValueAtTime(200,e.currentTime),n.frequency.exponentialRampToValueAtTime(70,e.currentTime+.05),t.gain.setValueAtTime(1,e.currentTime),t.gain.exponentialRampToValueAtTime(.001,e.currentTime+1),n.connect(t),t.connect(e.destination),n.start(),n.stop(e.currentTime+1.5)}function ee(){const e=g(),n=e.sampleRate*.2,t=e.createBuffer(1,n,e.sampleRate),s=t.getChannelData(0);for(let l=0;l<n;l++)s[l]=Math.random()*2-1;const o=e.createBufferSource();o.buffer=t;const r=e.createBiquadFilter();r.type="highpass",r.frequency.setValueAtTime(1e3,e.currentTime);const i=e.createGain();i.gain.setValueAtTime(1,e.currentTime),i.gain.exponentialRampToValueAtTime(.01,e.currentTime+.2),o.connect(r),r.connect(i),i.connect(e.destination),o.start(),o.stop(e.currentTime+.2);const c=e.createOscillator();c.type="sine",c.frequency.setValueAtTime(150,e.currentTime);const a=e.createGain();a.gain.setValueAtTime(.7,e.currentTime),a.gain.exponentialRampToValueAtTime(.01,e.currentTime+.1),c.connect(a),a.connect(e.destination),c.start(),c.stop(e.currentTime+.1)}function te(){const e=g(),n=e.sampleRate*1.5,t=e.createBuffer(1,n,e.sampleRate),s=t.getChannelData(0);for(let d=0;d<n;d++)s[d]=Math.random()*2-1;const o=e.createBufferSource();o.buffer=t;const r=e.createBiquadFilter();r.type="highpass",r.frequency.setValueAtTime(4e3,e.currentTime);const i=e.createBiquadFilter();i.type="lowpass",i.frequency.setValueAtTime(12e3,e.currentTime);const c=e.createGain();c.gain.setValueAtTime(1,e.currentTime),c.gain.exponentialRampToValueAtTime(.001,e.currentTime+1.5),o.connect(r),r.connect(i),i.connect(c),c.connect(e.destination),o.start(),o.stop(e.currentTime+1.5);const a=e.createOscillator();a.type="triangle",a.frequency.setValueAtTime(1e4,e.currentTime);const l=e.createGain();l.gain.setValueAtTime(.05,e.currentTime),l.gain.exponentialRampToValueAtTime(.001,e.currentTime+1.5),a.connect(l),l.connect(e.destination),a.start(),a.stop(e.currentTime+1.5)}function ne(){const e=g(),n=e.sampleRate*.5,t=e.createBuffer(1,n,e.sampleRate),s=t.getChannelData(0);for(let a=0;a<n;a++)s[a]=Math.random()*2-1;const o=e.createBufferSource();o.buffer=t;const r=e.createBiquadFilter();r.type="highpass",r.frequency.setValueAtTime(5e3,e.currentTime);const i=e.createBiquadFilter();i.type="lowpass",i.frequency.setValueAtTime(1e4,e.currentTime);const c=e.createGain();c.gain.setValueAtTime(.6,e.currentTime),c.gain.exponentialRampToValueAtTime(.001,e.currentTime+.5),o.connect(r),r.connect(i),i.connect(c),c.connect(e.destination),o.start(),o.stop(e.currentTime+.5)}function oe(){const e=g(),n=e.sampleRate*1.2,t=e.createBuffer(1,n,e.sampleRate),s=t.getChannelData(0);for(let a=0;a<n;a++)s[a]=Math.random()*2-1;const o=e.createBufferSource();o.buffer=t;const r=e.createBiquadFilter();r.type="highpass",r.frequency.setValueAtTime(3e3,e.currentTime);const i=e.createBiquadFilter();i.type="lowpass",i.frequency.setValueAtTime(9e3,e.currentTime);const c=e.createGain();c.gain.setValueAtTime(.8,e.currentTime),c.gain.exponentialRampToValueAtTime(.001,e.currentTime+1.2),o.connect(r),r.connect(i),i.connect(c),c.connect(e.destination),o.start(),o.stop(e.currentTime+1.2)}function N(e=99,n=500){const t=g(),s=t.createOscillator();s.type="sine",s.frequency.setValueAtTime(e,t.currentTime);const o=t.createGain();o.gain.setValueAtTime(1,t.currentTime),o.gain.exponentialRampToValueAtTime(.001,t.currentTime+.5),s.detune.setValueAtTime(-5,t.currentTime),s.connect(o),o.connect(t.destination),s.start(),s.stop(t.currentTime+n/1e3)}function re(){N(120,400)}const k={hihat:Z,kick:X,snare:ee,crash:te,"hihat-open":ne,ride:oe,"tom-low":N,"tom-high":re},H=e=>{try{k[e]()}catch(n){console.error(`Error playing ${e}`,n),Y(),k[e]()}if(B){const n=Date.now()-V;T.push({instrument:e,time:n}),console.log(`Recording ${e} at time ${n}ms`)}};let B=!1,V=0,T=[],y=0,P=null;function se(){B=!0,V=Date.now(),T=[],console.log("Recording started")}function R(){B=!1,T.push({instrument:null,time:Date.now()-V}),console.log("Recording stopped")}function ie(){const e=()=>{y>=T.length&&(y=0);const{instrument:n,time:t}=T[y],s=y===0?0:T[y-1].time;P=setTimeout(()=>{console.log(`Playing ${n} after ${t}ms`),n&&H(n),y++,e()},t-s)};console.log("Loop play starting"),e()}function E(){P&&clearTimeout(P),console.log("Loop stopped")}const p={Icons:"Icons",Text:"Courier"},ce=async()=>{const e=new FontFace(p.Icons,"url(./fonts/material.woff2)");return document.fonts.add(e),e.load().catch(n=>console.error(n))},O={idle:"#FFF",readyToRecord:"#0FF",recording:"#FD0041",playing:"#0F0"};class w extends h.Scene{constructor(){super("ControlsScene");x(this,"controls")}static get controlsSceneHeight(){const t=window.innerWidth,s=window.innerHeight;return Math.max(s,t)/10}create(){this.createControlButtons()}updateControlsText(){const{record:{text:t},stop:{text:s},play:{text:o}}=this.controls;[t,s,o].forEach(i=>i.setFontFamily(p.Icons).setText(i.getData("initial")).setColor(O.idle));const r=O[this.controls.state];switch(this.controls.state){case"idle":break;case"readyToRecord":t.setFontFamily(p.Text).setText("Hit a pad to start").setColor(r);break;case"recording":t.setFontFamily(p.Icons).setColor(r);break;case"playing":o.setFontFamily(p.Icons).setColor(r);break}}addControlButton(){const t=this.add.rectangle().setFillStyle(u("#000")).setStrokeStyle(2,u("#FFF"),.8).setOrigin(0,0);return t.setInteractive().on("pointerdown",()=>t.setFillStyle(u("#666"))).on("pointerup",()=>t.setFillStyle(u("#000"))).on("pointerout",()=>t.setFillStyle(u("#000"))),t}addControlText(t){return this.add.text(0,0,t,{fontFamily:p.Icons,fontSize:20,color:"#FFF",align:"center",resolution:2}).setOrigin(.5,.5).setData("initial",t)}createControlButtons(){this.controls={state:"idle",stop:{button:this.addControlButton(),text:this.addControlText("stop")},record:{button:this.addControlButton(),text:this.addControlText("fiber_manual_record")},play:{button:this.addControlButton(),text:this.addControlText("play_arrow")}};const{record:t,stop:s,play:o}=this.controls;t.button.setInteractive().on("pointerdown",()=>{this.controls.state==="idle"||this.controls.state==="playing"?(E(),this.controls.state="readyToRecord"):this.controls.state==="readyToRecord"?this.controls.state="idle":this.controls.state==="recording"&&(this.controls.state="idle",R()),this.updateControlsText()}),s.button.setInteractive().on("pointerdown",()=>{this.controls.state==="recording"&&R(),this.controls.state==="playing"&&E(),this.controls.state="idle",this.updateControlsText()}),o.button.setInteractive().on("pointerdown",()=>{this.controls.state==="recording"&&R(),T.length>0?(this.controls.state="playing",ie(),this.updateControlsText()):(this.controls.state="idle",this.updateControlsText(),console.log("No loop to play"),this.controls.play.text.setFontFamily(p.Text).setText("Record first!"),this.time.delayedCall(2e3,()=>{this.updateControlsText()}))});const r=()=>{const i=w.controlsSceneHeight,c=window.innerWidth/3;[s,t,o].forEach(({button:a,text:l},d)=>{a.setSize(c,i).setPosition(c*d,-1),l.setFontSize(i/3).setWordWrapWidth(a.width,!0).setSize(a.width,a.height).setPosition(a.getCenter().x,a.getCenter().y)})};window.addEventListener("resize",r),r()}}const W=()=>window.matchMedia("(prefers-color-scheme: dark)").matches,ae={hihat:"#FDA341",kick:"#F24E1E",snare:"#4A90E2",crash:"#A0D8C5","hihat-open":"#F9F871",ride:"#F5C542","tom-low":"#FF7F50","tom-high":"#9B59B6"};class le extends h.Scene{constructor(){super("DrumsScene")}create(){this.createPads()}createPads(){const n=[this.createPad("crash"),this.createPad("ride"),this.createPad("hihat-open"),this.createPad("hihat"),this.createPad("snare"),this.createPad("tom-low"),this.createPad("tom-high"),this.createPad("kick")],t=()=>{const r=window.innerWidth/4,i=(window.innerHeight-w.controlsSceneHeight)/2;n.forEach(({button:c},a)=>{const l=a%4*r,d=Math.floor(a/4)*i;c.setSize(r,i).setPosition(l,w.controlsSceneHeight+d)})};window.addEventListener("resize",t),t()}createPad(n){const t=this.add.rectangle().setFillStyle(u(ae[n],W())).setStrokeStyle(2,u("#FFF"),.8).setInteractive().setOrigin(0,0);return t.on("pointerdown",()=>{t.setAlpha(.7);const s=this.scene.get("ControlsScene");s.controls.state==="readyToRecord"&&(s.controls.state="recording",s.updateControlsText(),se()),H(n)}).on("pointerup",()=>t.setAlpha(1)).on("pointerout",()=>t.setAlpha(1)),{instrument:n,button:t}}}const D={selected:"#DDD",unselected:"#000"},m=class m extends h.Scene{constructor(){super("LoopTracksScene");x(this,"tracks")}static get sceneWidth(){return window.innerWidth/10}static get buttonHeight(){return window.innerHeight/m.numTracks}create(){this.cameras.main.setOrigin(0,0).setPosition(0,0).setViewport(0,0,m.sceneWidth,window.innerHeight).setBackgroundColor("#963"),this.createTracks()}createTracks(){this.tracks=new Array(m.numTracks).fill(null).map((t,s)=>({button:this.add.rectangle().setOrigin(0,0).setPosition(0,s*m.buttonHeight).setSize(m.sceneWidth,m.buttonHeight).setStrokeStyle(2,u("#FFF"),.8).setInteractive().on(h.Input.Events.POINTER_DOWN,()=>this.selectTrack(s)),selected:!1,scene:this.scene.get("EmptyScene")})),this.selectTrack(0)}selectTrack(t){const s=this.tracks[t];s.selected||(this.tracks.forEach(o=>o.selected=!1),s.selected=!0,this.updateSelectedColor())}updateSelectedColor(){this.tracks.forEach(({button:t,selected:s})=>{t.setFillStyle(u(s?D.selected:D.unselected))})}};x(m,"numTracks",5);let f=m;class ue extends h.Scene{constructor(){super("EmptyScene")}create(){this.cameras.main.setOrigin(0,0).setPosition(f.sceneWidth,0).setViewport(f.sceneWidth,0,window.innerWidth-f.sceneWidth,window.innerHeight).setBackgroundColor("#147");const n=5,t=5,s=(window.innerWidth-f.sceneWidth)/n,o=window.innerHeight/t,r=[];for(let l=0;l<n;l++){r.push([]);for(let d=0;d<t;d++)r[l].push(this.add.rectangle().setOrigin(0,0).setPosition(l*s,d*o).setSize(s,o).setStrokeStyle(2,u("#FFF"),.1))}const i=r[1][2];this.addText(i,"Drums");const c=r[3][2];this.addText(c,"Other Drums"),[i,c].forEach(l=>l.setFillStyle(u("#FFF"),.5).setInteractive().on(h.Input.Events.POINTER_DOWN,()=>l.setFillStyle(u("#FFF"),.8)).on(h.Input.Events.POINTER_UP,()=>l.setFillStyle(u("#FFF"),.5)))}addText(n,t){this.add.text(n.x+n.width/2,n.y+n.height/2,t,{fontSize:"24px",color:"#FFF",fontFamily:p.Text}).setOrigin(.5)}}function de(e){const n=window.innerWidth,t=window.innerHeight;e.scale.resize(n,t),e.scene.scenes.forEach(s=>{var o,r;return(r=(o=s.sys)==null?void 0:o.scale)==null?void 0:r.refresh()})}let v=!1;const he=()=>(v||(v=!0,ce().then(()=>{const e=new h.Game({type:h.AUTO,mode:h.Scale.RESIZE,parent:"phaser-container",width:window.innerWidth,height:window.innerHeight,backgroundColor:W()?"#333":"#DDD",scene:[w,f,ue,le],input:{activePointers:4}});window.addEventListener("resize",()=>{de(e)}),e.scene.start("ControlsScene"),e.scene.start("DrumsScene")})),F.jsx(F.Fragment,{}));function me(){return F.jsx(he,{})}A.createRoot(document.getElementById("root")).render(F.jsx(M.StrictMode,{children:F.jsx(me,{})}));
